# Exploratory Data Analysis (EDA)

```{r, echo = FALSE, message = FALSE}
source(here::here("scripts/setup.R"))
```

```{r, echo = FALSE, message = FALSE, warning = FALSE}
#  Load the cleaned dataset from the data.Rmd
setwd(here::here("Data_New/"))
premier_league_results <- read_csv("premier_league_results_clean.csv")
```

## Premier League Results

### Single variable Analysis

Our EDA started with analysing each variable in our dataset inorder to gain an insight on what kind of data we have and what can be used in move forward with our analysis and model fitting. 


We started with graphing the total count of matches for each season, then to ensure that all chosen teams have played the same amount of games we plotted the number of matches per team.As shown below, all teams have played the same amount of matches.   
```{r, echo=FALSE, include=FALSE}
#To be removed
str(premier_league_results) 
```

```{r}
# match_date
match_date <- premier_league_results %>% 
  select(match_date) %>% 
  ggplot(aes(x = year(match_date))) +
  geom_bar() 

numb_of_gamesH <- premier_league_results %>% 
  select(home_team) %>% 
  ggplot(aes(x = home_team)) +
  geom_bar()


numb_of_gamesA <- premier_league_results %>% 
  select(away_team) %>% 
  ggplot(aes(x = away_team)) +
  geom_bar()


match_date 
numb_of_gamesH 
numb_of_gamesA


# Ok seems good for the repartition of the years
```

```{r, include=FALSE}
# Home team
premier_league_results %>% 
  select(home_team) %>% 
  ggplot(aes(x = home_team)) +
  geom_bar()

# All good, same numbers

# Away team
premier_league_results %>% 
  select(away_team) %>% 
  ggplot(aes(x = away_team)) +
  geom_bar()

# All good, same numbers
```

<br>

**_Outliers_**

Below are osme boxplots to show if there exists any outliers in our data for each of `full time home goals`, `half time home goals`, `full time away goals` and `half time away goals`. Following that we studied the correlation between 

```{r}
# Full-time home goals
BP_FTHG <- premier_league_results %>% 
  select(full_time_home_goals) %>% 
  ggplot(aes(x = full_time_home_goals)) +
  geom_boxplot() +
  xlim(0,8)

# half-time home goals
BP_HTHG <- premier_league_results %>% 
  select(half_time_home_goals) %>% 
  ggplot(aes(x = half_time_home_goals)) +
  geom_boxplot()+
  xlim(0,5)

BP_FTHG + BP_HTHG

# Full-time against half-time - home team
corr_home <- premier_league_results %>% 
  select(full_time_home_goals, half_time_home_goals) %>% 
  ggplot(aes(x = full_time_home_goals, y = half_time_home_goals)) +
  geom_point() +
  geom_abline(intercept = 0, slope = 1)

# Full-time away goals
BP_FTAG <- premier_league_results %>% 
  select(full_time_away_goals) %>% 
  ggplot(aes(x = full_time_away_goals)) +
  geom_boxplot()+
  xlim(0,8)

# half-time away goals
BP_HTAG <- premier_league_results %>% 
  select(half_time_away_goals) %>% 
  ggplot(aes(x = half_time_away_goals)) +
  geom_boxplot()+
  xlim(0,5)

BP_FTAG + BP_HTAG

# Full-time against half-time - away team

corr_away <- premier_league_results %>% 
  select(full_time_away_goals, half_time_away_goals) %>% 
  ggplot(aes(x = full_time_away_goals, y = half_time_away_goals)) +
  geom_point() +
  geom_abline(intercept = 0, slope = 1)

corr_home + corr_away
```
```{r}
# full-time results
premier_league_results %>% 
  select(full_time_results) %>% 
  ggplot(aes(x = full_time_results)) +
  geom_bar()

# half-time results
premier_league_results %>% 
  select(half_time_results) %>% 
  ggplot(aes(x = half_time_results)) +
  geom_bar()
```

```{r}
# home shots
premier_league_results %>% 
  select(home_shots) %>% 
  ggplot(aes(x = home_shots)) +
  geom_boxplot() +
  xlim(0,40)

# home shots on target
premier_league_results %>% 
  select(home_shots_ontarget) %>% 
  ggplot(aes(x = home_shots_ontarget)) +
  geom_boxplot() +
  xlim(0,40)

# shots versus on target
premier_league_results %>% 
  select(home_shots, home_shots_ontarget) %>% 
  ggplot(aes(x = home_shots, y = home_shots_ontarget)) +
  geom_point() +
  geom_abline(intercept = 0, slope = 1)
```

```{r}
# home shots
premier_league_results %>% 
  select(away_shots) %>% 
  ggplot(aes(x = away_shots)) +
  geom_boxplot() +
  xlim(0,40)

# home shots on target
premier_league_results %>% 
  select(away_shots_ontarget) %>% 
  ggplot(aes(x = away_shots_ontarget)) +
  geom_boxplot() +
  xlim(0,40)

# shots versus on target
premier_league_results %>% 
  select(away_shots, away_shots_ontarget) %>% 
  ggplot(aes(x = away_shots, y = away_shots_ontarget)) +
  geom_point() +
  geom_abline(intercept = 0, slope = 1)
```

```{r}
# fouls
premier_league_results %>% 
  select(home_fouls) %>% 
  ggplot(aes(x = home_fouls)) +
  geom_boxplot() +
  xlim(0,30)

premier_league_results %>% 
  select(away_fouls) %>% 
  ggplot(aes(x = away_fouls)) +
  geom_boxplot() +
  xlim(0,30)
```
```{r}
# corners
premier_league_results %>% 
  select(home_corners) %>% 
  ggplot(aes(x = home_corners)) +
  geom_boxplot() +
  xlim(0,20)

premier_league_results %>% 
  select(away_corners) %>% 
  ggplot(aes(x = away_corners)) +
  geom_boxplot() +
  xlim(0,20)
```

```{r}
# yellow cards
premier_league_results %>% 
  select(home_yellow_cards) %>% 
  ggplot(aes(x = home_yellow_cards)) +
  geom_boxplot() +
  xlim(0,8)

premier_league_results %>% 
  select(away_yellow_cards) %>% 
  ggplot(aes(x = away_yellow_cards)) +
  geom_boxplot() +
  xlim(0,8)
```

```{r}
# red cards
premier_league_results %>% 
  select(home_red_cards) %>% 
  ggplot(aes(x = home_red_cards)) +
  geom_boxplot()

premier_league_results %>% 
  select(away_red_cards) %>% 
  ggplot(aes(x = away_red_cards)) +
  geom_boxplot()
```
```{r, echo=FALSE}
  # plot_boxplot(premier_league_results, , title = NULL, ggtheme = theme_gray(),
  # theme_config = list(), ...)
```
## Multivariate Analysis


### Premiere League Results 2017-2018

```{r, echo=FALSE}
PLR17 <- premier_league_results %>% filter(match_date <= as.Date("2018-05-13"))	
```

```{r, echo=FALSE}
data_frame(PLR17$full_time_home_goals, PLR17$full_time_away_goals, PLR17$full_time_results, PLR17$home_shots, PLR17$away_shots, PLR17$home_fouls, PLR17$away_fouls, PLR17$home_yellow_cards, PLR17$away_yellow_cards, PLR17$home_red_cards, PLR17$away_red_cards) %>%
  plot_histogram(ncol = 3)
```



```{r, echo=FALSE}
data_frame(PLR17$full_time_home_goals, PLR17$full_time_away_goals, PLR17$full_time_results, PLR17$home_shots, PLR17$away_shots, PLR17$home_fouls, PLR17$away_fouls, PLR17$home_yellow_cards, PLR17$away_yellow_cards, PLR17$home_red_cards, PLR17$away_red_cards) %>%
  plot_density(ncol = 3)
```

```{r, echo=FALSE}
#not sure if we should keep this
data_frame(PLR17$full_time_home_goals, PLR17$full_time_away_goals, PLR17$full_time_results, PLR17$home_shots, PLR17$away_shots, PLR17$home_fouls, PLR17$away_fouls, PLR17$home_yellow_cards, PLR17$away_yellow_cards, PLR17$home_red_cards, PLR17$away_red_cards) %>%
  plot_correlation()
```

```{r, echo=FALSE}
PLR17 %>%
  group_by(home_team, full_time_results) %>% summarise(counts = n(), .groups = 'drop') %>%
  plot_ly(x = ~home_team, y = ~counts, type = 'bar', color = ~full_time_results, height = 500, width = 1000) %>%
  layout(title= 'Number of wins when Home 17-18', barmode = 'stack' )
```


```{r, echo=FALSE}
# to discuss which type to keep
PLR17 %>%
  group_by(away_team, full_time_results) %>% summarise(counts = n(), .groups = 'drop') %>%
  plot_ly(x = ~away_team, y = ~counts, type = 'bar', color = ~full_time_results, height = 500, width = 1000) %>%
  layout(title= 'Number of wins when Away 17-18', barmode = 'group' )
```


```{r}
ggplot(PLR17, aes(x = full_time_home_goals, y = home_team, fill = home_team)) +
  geom_density_ridges() +
  theme_ridges() + 
  theme(legend.position = "none")
```


```{r}
ggplot(PLR17, aes(x = full_time_away_goals, y = away_team, fill = away_team)) +
  geom_density_ridges() +
  theme_ridges() + 
  theme(legend.position = "none")
```


### Premiere League Results 2017-2018


```{r, echo=FALSE}
PLR18 <- premier_league_results %>% filter(match_date > as.Date("2018-05-13"))
```

```{r, echo=FALSE}
# data_frame(PLR18$full_time_home_goals, PLR18$full_time_away_goals, PLR18$full_time_results, PLR18$home_shots, PLR18$away_shots, PLR18$home_fouls, PLR18$away_fouls, PLR18$home_yellow_cards, PLR18$away_yellow_cards, PLR18$home_red_cards, PLR18$away_red_cards) %>%
#   plot_histogram(ncol = 3)
```


```{r, echo=FALSE}
# data_frame(PLR18$full_time_home_goals, PLR18$full_time_away_goals, PLR18$full_time_results, PLR18$home_shots, PLR18$away_shots, PLR18$home_fouls, PLR18$away_fouls, PLR18$home_yellow_cards, PLR18$away_yellow_cards, PLR18$home_red_cards, PLR18$away_red_cards) %>%
#   plot_density(ncol = 3)
```

```{r, echo=FALSE}
# data_frame(PLR18$full_time_home_goals, PLR18$full_time_away_goals, PLR18$full_time_results, PLR18$home_shots, PLR18$away_shots, PLR18$home_fouls, PLR18$away_fouls, PLR18$home_yellow_cards, PLR18$away_yellow_cards, PLR18$home_red_cards, PLR18$away_red_cards) %>%
#   plot_correlation()
```


```{r, echo=FALSE}
PLR18 %>%
  group_by(home_team, full_time_results) %>% summarise(counts = n(), .groups = 'drop') %>%
  plot_ly(x = ~home_team, y = ~counts, type = 'bar', color = ~full_time_results, height = 500, width = 1000) %>%
  layout(title= 'Number of wins when Home 18-19', barmode = 'stack' )
```


```{r, echo=FALSE}
PLR18 %>%
  group_by(away_team, full_time_results) %>% summarise(counts = n(), .groups = 'drop') %>%
  plot_ly(x = ~away_team, y = ~counts, type = 'bar', color = ~full_time_results, height = 500, width = 1000) %>%
  layout(title= 'Number of wins when Away 18-19', barmode = 'stack' )
```



```{r}
ggplot(PLR18, aes(x = full_time_home_goals, y = home_team, fill = home_team)) +
  geom_density_ridges() +
  theme_ridges() + 
  theme(legend.position = "none")
```


```{r}
ggplot(PLR18, aes(x = full_time_away_goals, y = away_team, fill = away_team)) +
  geom_density_ridges() +
  theme_ridges() + 
  theme(legend.position = "none")
```


#Premiere League Results


```{r, echo=FALSE}
#might remove
data_frame(premier_league_results$full_time_home_goals, premier_league_results$full_time_away_goals, premier_league_results$full_time_results, premier_league_results$home_shots, premier_league_results$away_shots, premier_league_results$home_fouls, premier_league_results$away_fouls, premier_league_results$home_yellow_cards, premier_league_results$away_yellow_cards, premier_league_results$home_red_cards, premier_league_results$away_red_cards) %>%
  plot_histogram(ncol = 3)
```


```{r, echo=FALSE}
#might remove
data_frame(premier_league_results$full_time_home_goals, premier_league_results$full_time_away_goals, premier_league_results$full_time_results, premier_league_results$home_shots, premier_league_results$away_shots, premier_league_results$home_fouls, premier_league_results$away_fouls, premier_league_results$home_yellow_cards, premier_league_results$away_yellow_cards, premier_league_results$home_red_cards, premier_league_results$away_red_cards) %>%
  plot_density(ncol = 3)
```


```{r, echo=FALSE}
#might remove
data_frame(premier_league_results$full_time_home_goals, premier_league_results$full_time_away_goals, premier_league_results$home_shots, premier_league_results$away_shots, premier_league_results$home_fouls, premier_league_results$away_fouls, premier_league_results$home_yellow_cards, premier_league_results$away_yellow_cards, premier_league_results$home_red_cards, premier_league_results$away_red_cards) %>%
  plot_correlation()
```

```{r}
ggplot(premier_league_results, aes(x = full_time_home_goals, y = home_team, fill = home_team)) +
  geom_density_ridges() +
  theme_ridges() + 
  theme(legend.position = "none")
```
```{r}
ggplot(premier_league_results, aes(x = full_time_away_goals, y = away_team, fill = away_team)) +
  geom_density_ridges() +
  theme_ridges() + 
  theme(legend.position = "none")
```



