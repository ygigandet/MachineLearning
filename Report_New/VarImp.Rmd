# Variable of Importance

```{r, echo = FALSE, message = FALSE}
source(here::here("scripts/setup.R"))
```

```{r, echo = FALSE, message = FALSE, warning = FALSE}
#  Load the cleaned dataset from the data.Rmd
setwd(here::here("Data_New/"))
premier_league_results <- read_csv("premier_league_results_clean.csv")
```

Variable importance is a method that provides a measure of the importance of each feature for the model prediction quality. It helps to analyze the link between the features and the response, through the model predictions. 

#As the teacher with DALEX Package
```{r, echo = FALSE, message = FALSE, warning = FALSE}
# Take the NN machine model 
nnetFit

# Take the CART machine model 
classtreefit.pruned

# Take the NB machine model 
naivebayesfit

#Creating an explain object
x_train <- select(train_data1, -full_time_results)
y_train <- pull(train_data1, full_time_results)

explainer_nn <- DALEX::explain(model = nnetFit,
                                is_multiclass = TRUE,
                                data = x_train,
                                y = y_train,
                                label = "NN machine model")
  #NN fonctionne

explainer_cart <- DALEX::explain(model = classtreefit.pruned,
                                is_multiclass = TRUE,
                                data = x_train,
                                y = y_train,
                                label = "CART machine model ")
  #CART fonctionne

explainer_nb <- DALEX::explain(model = naivebayesfit,
                                is_multiclass = TRUE,
                                data = x_train,
                                y = as.numeric(y_train),
                                label = "NB machine model")
  #Problem : erreur Model info detected regression task but 'y' is a factor . (  WARNING  ), so i turn into as.numeric
  # Another error : the predict_function returns an error when executed (  WARNING  ) 
```


# Plotting the feature importance
```{r, echo = FALSE, message = FALSE, warning = FALSE}
calculate_importance <- function(your_model_explainer, n_permutations = 10) {
  imp <- model_parts(explainer = your_model_explainer,
                     B = n_permutations,
                     type = "ratio",
                     N = NULL)
  return(imp)
}

importance_nn <- calculate_importance(explainer_nn)
importance_cart <- calculate_importance(explainer_cart)
#importance_nb <- calculate_importance(explainer_nb)

plot(importance_nn, importance_cart) +
 ggtitle("Mean variable-importance ratio over 10 permutations", "")

```

# interpretation
Once weâ€™ve identified influential variables across all three models, next we likely want to understand how the relationship between these influential variables and the predicted response differ between the models.
```{r, echo = FALSE, message = FALSE, warning = FALSE}
# compute PDP for a given variable --> uses the pdp package

```
